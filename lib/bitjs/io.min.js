var bitjs=bitjs||{};bitjs.io=bitjs.io||{};
(function(){bitjs.BIT=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768];var h=[0,1,3,7,15,31,63,127,255];bitjs.io.BitStream=function(a,c,b,d){if(!a||!a.toString||"[object ArrayBuffer]"!==a.toString())throw"Error! BitArray constructed with an invalid ArrayBuffer object";this.bytes=new Uint8Array(a,b||0,d||a.byteLength);this.bitPtr=this.bytePtr=0;this.peekBits=c?this.peekBits_rtl:this.peekBits_ltr};bitjs.io.BitStream.prototype.peekBits_ltr=function(a,c){if(0>=a||"number"!=typeof a)return 0;
for(var b=this.bytePtr,d=this.bitPtr,e=0,f=0,g=this.bytes;0<a;){if(b>=g.length)throw"Error!  Overflowed the bit stream! n="+a+", bytePtr="+b+", bytes.length="+g.length+", bitPtr="+d;var k=8-d;if(a>=k){var l=h[k]<<d,e=e|(g[b]&l)>>d<<f;b++;d=0;f+=k;a-=k}else l=h[a]<<d,e|=(g[b]&l)>>d<<f,d+=a,f+=a,a=0}c&&(this.bitPtr=d,this.bytePtr=b);return e};bitjs.io.BitStream.prototype.peekBits_rtl=function(a,c){if(0>=a||"number"!=typeof a)return 0;for(var b=this.bytePtr,d=this.bitPtr,e=0,f=this.bytes;0<a;){if(b>=
f.length)throw"Error!  Overflowed the bit stream! n="+a+", bytePtr="+b+", bytes.length="+f.length+", bitPtr="+d;var g=8-d;a>=g?(e<<=g,e|=h[g]&f[b],b++,d=0,a-=g):(e<<=a,e|=(f[b]&h[a]<<8-a-d)>>8-a-d,d+=a,a=0)}c&&(this.bitPtr=d,this.bytePtr=b);return e};bitjs.io.BitStream.prototype.getBits=function(){return((this.bytes[this.bytePtr]&255)<<16)+((this.bytes[this.bytePtr+1]&255)<<8)+(this.bytes[this.bytePtr+2]&255)>>>8-this.bitPtr&65535};bitjs.io.BitStream.prototype.readBits=function(a){return this.peekBits(a,
!0)};bitjs.io.BitStream.prototype.peekBytes=function(a,c){if(0>=a||"number"!=typeof a)return 0;for(;0!=this.bitPtr;)this.readBits(1);c=c||!1;var b=this.bytePtr,b=this.bytes.subarray(b,b+a);c&&(this.bytePtr+=a);return b};bitjs.io.BitStream.prototype.readBytes=function(a){return this.peekBytes(a,!0)};bitjs.io.ByteStream=function(a,c,b){this.bytes=new Uint8Array(a,c||0,b||a.byteLength);this.ptr=0};bitjs.io.ByteStream.prototype.peekNumber=function(a){if(0>=a||"number"!=typeof a)return-1;var c=0;for(a=
this.ptr+a-1;a>=this.ptr;)c<<=8,c|=this.bytes[a],--a;return c};bitjs.io.ByteStream.prototype.readNumber=function(a){var c=this.peekNumber(a);this.ptr+=a;return c};bitjs.io.ByteStream.prototype.peekBytes=function(a,c){if(0>=a||"number"!=typeof a)return 0;var b=this.bytes.subarray(this.ptr,this.ptr+a);c&&(this.ptr+=a);return b};bitjs.io.ByteStream.prototype.readBytes=function(a){return this.peekBytes(a,!0)};bitjs.io.ByteStream.prototype.peekString=function(a){if(0>=a||"number"!=typeof a)return 0;var c=
"",b=this.ptr;for(a=this.ptr+a;b<a;++b)c+=String.fromCharCode(this.bytes[b]);return c};bitjs.io.ByteStream.prototype.readString=function(a){var c=this.peekString(a);this.ptr+=a;return c};bitjs.io.ByteBuffer=function(a){if("number"!=typeof a||0>=a)throw"Error! ByteBuffer initialized with '"+a+"'";this.data=new Uint8Array(a);this.ptr=0};bitjs.io.ByteBuffer.prototype.insertByte=function(a){this.data[this.ptr++]=a};bitjs.io.ByteBuffer.prototype.insertBytes=function(a){this.data.set(a,this.ptr);this.ptr+=
a.length}})();
